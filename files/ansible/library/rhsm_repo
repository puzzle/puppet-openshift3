#!/bin/bash
# WANT_JSON

NL="
"
NAME=`jq -r .name < $1`
ENABLE=`jq -r .enable < $1`

REPO_ENABLED=`cat /var/lib/rhsm/cache/content_overrides.json | jq -r ".[] | select (.contentLabel == \"${NAME}\" and .name == \"enabled\").value"`

if [ 0$REPO_ENABLED -ne 0$ENABLE ]; then
  if [ 0$ENABLE -eq 1 ]; then
    ACTION="enable"
  else
    ACTION="disable"
  fi

  OUTPUT=`subscription-manager repos --${ACTION} "${NAME}" 2>&1`

  if [ $? -eq 0 ]; then
    echo '{"changed": true}'
  else
    echo "{\"failed\": true, \"msg\": \"Could not ${ACTION} repo '${NAME}'${NL}${OUTPUT}\"}"
  fi
else
  echo '{"changed": false}'
fi
